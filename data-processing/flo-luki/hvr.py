#!/usr/bin/env python

import math
import numpy as np
import matplotlib.pyplot as plt
from scipy.interpolate import interp1d

rrTuples = [(1512318931492,0.116144),(1512318932361,0.8793759999999999),(1512318933173,0.813008),(1512318934117,0.8296),(1512318935286,0.8793759999999999),(1512318936098,0.862784),(1512318936638,0.813008),(1512318937446,0.8461919999999999),(1512318938616,0.813008),(1512318939246,0.796416),(1512318939877,0.779824),(1512318940598,0.813008),(1512318941406,0.796416),(1512318942306,0.9125599999999999),(1512318943386,0.713456),(1512318944196,0.74664),(1512318944646,0.796416),(1512318945366,0.796416),(1512318946176,0.796416),(1512318947075,0.8461919999999999),(1512318948246,0.8793759999999999),(1512318948786,0.895968),(1512318949956,0.895968),(1512318950588,0.895968),(1512318951846,0.929152),(1512318952476,0.962336),(1512318953646,0.680272),(1512318954186,0.779824),(1512318954817,0.74664),(1512318955446,0.7300479999999999),(1512318956526,0.7632319999999999),(1512318957335,0.8296),(1512318957967,0.862784),(1512318958686,0.813008),(1512318960036,1.1448479999999999),(1512318960665,0.7632319999999999),(1512318961387,0.713456),(1512318962645,0.862784),(1512318963366,0.813008),(1512318963907,0.813008),(1512318964626,0.779824),(1512318965347,0.7632319999999999),(1512318966515,0.813008),(1512318967147,0.862784),(1512318967958,0.9125599999999999),(1512318969035,0.9457439999999999),(1512318970116,0.9789279999999999),(1512318970835,0.8461919999999999),(1512318971916,0.779824),(1512318972547,0.779824),(1512318973087,0.779824),(1512318973897,0.8296),(1512318974886,0.8296),(1512318975605,0.8461919999999999),(1512318976505,0.8793759999999999),(1512318977497,0.962336),(1512318978305,0.8793759999999999),(1512318979025,0.7300479999999999),(1512318979836,0.796416),(1512318980645,0.8461919999999999),(1512318981906,0.8461919999999999),(1512318982447,0.895968),(1512318983706,1.012112),(1512318984247,0.813008),(1512318985416,1.012112),(1512318986138,0.8793759999999999),(1512318987216,0.8296),(1512318987846,0.779824),(1512318988477,0.6968639999999999),(1512318989375,0.9457439999999999),(1512318990006,0.597312),(1512318990816,0.779824),(1512318991805,0.6968639999999999),(1512318992165,0.680272),(1512318992345,0.18251199999999998),(1512318993245,0.8793759999999999),(1512318993875,0.613904),(1512318994325,0.464576),(1512318995225,0.929152),(1512318995949,0.680272),(1512318996666,0.033184),(1512318996754,0.38161599999999996),(1512318997385,0.315248),(1512318997387,0.199104),(1512318998014,0.38161599999999996),(1512318998105,0.033184),(1512318998645,0.232288),(1512318998734,0.36502399999999996),(1512318999366,0.597312),(1512318999995,0.464576),(1512319000715,0.597312),(1512319001256,0.597312),(1512319001795,0.033184),(1512319002426,0.564128),(1512319002964,0.58072),(1512319003234,0.547536),(1512319003865,0.630496),(1512319004765,0.613904),(1512319005397,0.895968),(1512319006114,0.6968639999999999),(1512319006745,0.7300479999999999),(1512319007376,0.547536),(1512319008005,0.713456),(1512319008904,0.8461919999999999),(1512319009626,0.7632319999999999),(1512319010344,0.74664),(1512319011155,0.74664),(1512319011874,0.779824),(1512319012955,0.8461919999999999),(1512319013674,0.8793759999999999),(1512319014755,0.895968),(1512319015384,0.813008),(1512319016734,0.99552),(1512319017366,0.962336),(1512319018264,0.9789279999999999),(1512319019075,0.796416),(1512319019884,0.8296),(1512319020874,0.813008),(1512319021774,0.779824),(1512319022316,0.779824),(1512319023034,0.713456),(1512319023755,0.713456),(1512319024474,0.74664),(1512319025285,0.862784),(1512319026545,0.895968),(1512319027174,0.929152),(1512319028524,0.99552),(1512319029064,0.7632319999999999),(1512319029875,0.929152),(1512319030594,0.74664),(1512319031674,0.929152),(1512319032844,1.0287039999999998),(1512319033655,0.9789279999999999),(1512319034914,1.012112),(1512319035724,1.2112159999999998),(1512319036894,0.9125599999999999),(1512319037073,0.4148),(1512319037615,0.481168),(1512319038335,0.813008),(1512319038424,0.08295999999999999),(1512319039233,0.779824),(1512319039324,0.066368),(1512319039413,0.149328),(1512319040764,1.2775839999999998),(1512319041663,0.9457439999999999),(1512319043014,0.962336),(1512319043645,0.9789279999999999),(1512319044543,0.9457439999999999),(1512319045804,0.9789279999999999),(1512319046614,0.8461919999999999),(1512319047246,0.8793759999999999),(1512319048144,0.8296),(1512319048864,0.7632319999999999),(1512319049765,0.9125599999999999),(1512319050664,0.9125599999999999),(1512319051834,0.9457439999999999),(1512319052555,0.929152),(1512319053814,0.895968),(1512319054444,0.8793759999999999),(1512319055613,0.862784),(1512319056155,0.8461919999999999),(1512319056785,0.647088),(1512319057773,0.6636799999999999),(1512319058404,0.8461919999999999),(1512319059125,0.8296),(1512319059755,0.6968639999999999),(1512319060565,0.779824),(1512319061823,0.8461919999999999),(1512319062544,0.862784),(1512319063175,0.8793759999999999),(1512319064073,0.8793759999999999),(1512319064884,0.8793759999999999),(1512319066145,0.929152),(1512319066774,0.9457439999999999),(1512319067673,0.9125599999999999),(1512319068940,0.9457439999999999),(1512319069564,0.895968),(1512319070733,0.9125599999999999),(1512319071364,0.8296),(1512319072083,0.862784),(1512319073343,0.862784),(1512319073885,0.8793759999999999),(1512319075144,0.8793759999999999),(1512319075684,0.862784),(1512319076494,0.8793759999999999),(1512319077483,0.862784),(1512319078473,0.895968),(1512319079463,0.862784),(1512319080003,0.862784),(1512319081174,0.862784),(1512319081714,0.8793759999999999),(1512319082523,0.8461919999999999),(1512319083693,0.8461919999999999),(1512319084323,0.8461919999999999),(1512319085493,0.8793759999999999),(1512319086037,0.862784),(1512319086843,0.862784),(1512319087743,0.862784),(1512319088823,0.8461919999999999),(1512319089453,0.8296),(1512319090622,0.813008),(1512319090982,0.796416),(1512319091882,0.8461919999999999),(1512319093052,0.813008),(1512319093593,0.813008),(1512319094403,0.8296),(1512319095123,0.8296),(1512319096383,1.178032),(1512319097193,0.862784),(1512319098453,0.895968),(1512319098813,0.7632319999999999),(1512319099532,0.680272),(1512319100433,0.929152),(1512319101063,0.613904),(1512319102233,0.862784),(1512319102773,0.680272),(1512319103403,0.813008),(1512319104572,0.862784),(1512319105562,1.227808),(1512319106552,0.99552),(1512319107543,0.74664),(1512319108082,0.8296),(1512319108893,0.8296),(1512319109972,0.813008),(1512319110603,0.813008),(1512319111412,0.8296),(1512319112582,0.862784),(1512319113213,0.862784),(1512319113940,0.862784),(1512319115193,0.9125599999999999),(1512319115822,0.929152),(1512319116903,0.9457439999999999),(1512319117712,0.9125599999999999),(1512319118522,0.8793759999999999),(1512319119422,0.8793759999999999),(1512319120502,0.862784),(1512319121312,0.862784),(1512319122302,0.8296),(1512319122942,0.8296),(1512319123651,0.813008),(1512319124461,0.8461919999999999),(1512319125362,0.8461919999999999),(1512319126171,0.813008),(1512319127341,0.813008),(1512319127972,0.813008),(1512319128692,0.8296),(1512319129863,1.045296),(1512319130671,0.8296),(1512319131303,0.8296),(1512319132472,0.9457439999999999),(1512319134991,1.41032),(1512319135712,0.58072),(1512319136881,0.962336),(1512319136883,0.282064),(1512319137423,0.630496),(1512319138322,0.862784),(1512319139042,0.680272),(1512319140211,0.895968),(1512319140213,0.315248),(1512319140391,0.18251199999999998),(1512319141202,0.6636799999999999),(1512319141921,0.8296),(1512319143092,0.796416),(1512319143812,0.8296),(1512319144443,0.8461919999999999),(1512319145251,0.8793759999999999),(1512319146421,0.9125599999999999),(1512319147052,0.8461919999999999),(1512319148221,0.8461919999999999),(1512319148854,0.813008),(1512319149481,0.779824),(1512319150202,0.779824),(1512319151372,0.8461919999999999),(1512319152182,0.9125599999999999),(1512319152901,0.9125599999999999),(1512319154161,0.895968),(1512319154795,0.9125599999999999),(1512319155601,0.9125599999999999),(1512319156681,0.929152),(1512319157491,0.9457439999999999),(1512319158572,0.8793759999999999),(1512319159291,0.8793759999999999),(1512319160551,1.045296),(1512319161181,0.647088),(1512319161724,0.7300479999999999),(1512319162530,0.796416),(1512319163252,0.779824),(1512319164152,0.813008),(1512319165142,0.779824),(1512319165773,0.813008),(1512319166581,0.862784),(1512319167752,0.8793759999999999),(1512319168382,0.929152),(1512319169280,0.895968),(1512319170271,1.012112),(1512319171081,0.813008),(1512319171801,0.7632319999999999),(1512319172611,0.796416),(1512319173691,0.7300479999999999),(1512319174412,0.74664),(1512319174953,0.813008),(1512319176121,0.8461919999999999),(1512319176663,0.862784),(1512319177472,0.862784),(1512319178731,0.862784),(1512319179270,0.8793759999999999),(1512319180170,0.895968),(1512319181251,0.862784),(1512319182061,0.8296),(1512319182694,0.8296),(1512319183500,0.862784),(1512319184670,0.8461919999999999),(1512319185301,0.8461919999999999),(1512319186020,0.8461919999999999),(1512319187280,0.8461919999999999),(1512319187911,0.8793759999999999),(1512319188630,0.8296),(1512319189440,0.862784),(1512319190611,1.045296),(1512319191330,0.8296),(1512319191871,0.481168),(1512319192680,0.8296),(1512319193490,0.862784),(1512319194390,0.8793759999999999),(1512319195290,0.895968),(1512319196190,0.8793759999999999),(1512319197090,0.9125599999999999),(1512319198260,0.895968),(1512319198981,0.9457439999999999),(1512319200240,0.929152),(1512319200871,0.9125599999999999),(1512319202041,0.929152),(1512319202669,0.9125599999999999),(1512319203840,0.895968),(1512319204382,0.813008),(1512319205011,0.613904),(1512319205551,0.613904),(1512319206810,0.9125599999999999),(1512319207979,1.1448479999999999),(1512319208611,0.895968),(1512319209419,0.862784),(1512319210140,0.796416),(1512319210951,0.6636799999999999),(1512319211670,0.813008),(1512319212479,0.8296),(1512319213561,0.862784),(1512319214459,0.895968),(1512319215089,0.862784),(1512319215900,0.8296),(1512319216620,0.713456),(1512319217339,0.6636799999999999),(1512319218509,0.796416),(1512319219140,0.7300479999999999),(1512319219860,0.895968),(1512319221120,1.128256),(1512319221940,0.8296),(1512319222560,0.564128),(1512319223100,0.647088),(1512319223910,0.813008),(1512319224540,0.7632319999999999),(1512319225439,0.9125599999999999),(1512319226429,1.0287039999999998),(1512319227240,0.8296),(1512319228499,0.862784),(1512319229130,0.7300479999999999),(1512319229760,0.8461919999999999)]

measures = {}
results = {}

def calc_RR():
	RR_list = [i[1] for i in measures['RR']]
	RR_diff = []
	RR_sqdiff = []
	i = 0 
	while (i < (len(RR_list)-1)): 
		RR_diff.append(abs(RR_list[i] - RR_list[i+1])) 
		RR_sqdiff.append(math.pow(RR_list[i] - RR_list[i+1], 2))
		i += 1
	measures['RR_list'] = RR_list
	measures['RR_diff'] = RR_diff
	measures['RR_sqdiff'] = RR_sqdiff
		

def calc_ts_measures():
	RR_list = measures['RR_list']
	RR_diff = measures['RR_diff']
	RR_sqdiff = measures['RR_sqdiff']
	#measures['bpm'] = 60000 / np.mean(RR_list)
	results['ibi'] = np.mean(RR_list)
	results['sdnn'] = np.std(RR_list)
	results['sdsd'] = np.std(RR_diff)
	results['rmssd'] = np.sqrt(np.mean(RR_sqdiff))
	NN20 = [x for x in RR_diff if (x>20)]
	NN50 = [x for x in RR_diff if (x>50)]
	results['nn20'] = NN20
	results['nn50'] = NN50
	results['pnn20'] = float(len(NN20)) / float(len(RR_diff))
	results['pnn50'] = float(len(NN50)) / float(len(RR_diff))

	print(results)
	
def run():
	measures['RR'] = rrTuples
	calc_RR()
	calc_ts_measures()
	
run()
	